% consensus tracking with respect to a leader with bounded input.
% adaptive controller dynamic
% sigma-modification

function xdot=con_dyn_ada_track(t,x)

xdot=zeros(20,1);

% A=[0 1; -1 2]; B=[0; 1]; C=[1 0]
% A0=[0 1; -1 0];

K=-[1.2983  3.3878];
% K2=-[0 2]; % state feedback gain for the leader
G=[1.6857  4.3984; 4.3984   11.4769];
L=[-3; -6];
f1=0.002;


M=[0 0 0 0 0 0 0; -2 6 -1 -1 -1 -1 0; 0 -1 3 -1 0 0 -1; 0 -1 -1 2 0 0 0; 0 -1 0 0 2 -1 0; 0 -1 0 0 -1 3 -1; 0  0 -1 0 0 -1 2];

% the leader 
xdot(1) = x(2);
xdot(2) = -7*x(1)+2*x(2)-8*x(3);
xdot(3) = -2.5*x(1)-3*x(3);
xdot(4) = 3*x(1)-3*x(4)+x(5);
xdot(5) = -8*x(3)-7*x(4)+2*x(5);


% follower 1
xdot(6) = x(7);
xdot(7) = -x(6)+2*x(7)+x(30)*K*[x(8)-x(12)+x(8)-x(16)+x(8)-x(20)+x(8)-x(24)+x(8)-x(4); x(9)-x(13)+x(9)-x(17)+x(9)-x(21)+x(9)-x(25)+x(9)-x(5)]...
    +x(30)*adpunit(K*[x(8)-x(12)+x(8)-x(16)+x(8)-x(20)+x(8)-x(24)+x(8)-x(4); x(9)-x(13)+x(9)-x(17)+x(9)-x(21)+x(9)-x(25)+x(9)-x(5)],x(30));
xdot(8) = 3*x(6)-3*x(8)+x(9);
xdot(9) = 6*x(6)-7*x(8)+2*x(9)+x(30)*K*[x(8)-x(12)+x(8)-x(16)+x(8)-x(20)+x(8)-x(24)+x(8)-x(4); x(9)-x(13)+x(9)-x(17)+x(9)-x(21)+x(9)-x(25)+x(9)-x(5)]...
    +x(30)*adpunit(K*[x(8)-x(12)+x(8)-x(16)+x(8)-x(20)+x(8)-x(24)+x(8)-x(4); x(9)-x(13)+x(9)-x(17)+x(9)-x(21)+x(9)-x(25)+x(9)-x(5)],x(30));

% follower 2
xdot(10) = x(11);
xdot(11) = -x(10)+2*x(11)+x(31)*K*[x(12)-x(8)+x(12)-x(16)+x(12)-x(28); x(13)-x(9)+x(13)-x(17)+x(13)-x(29)]...
    +x(31)*adpunit(K*[x(12)-x(8)+x(12)-x(16)+x(12)-x(28); x(13)-x(9)+x(13)-x(17)+x(13)-x(29)],x(31));
xdot(12) = 3*x(10)-3*x(12)+x(13);
xdot(13) = 6*x(10)-7*x(12)+2*x(13)+x(31)*K*[x(12)-x(8)+x(12)-x(16)+x(12)-x(28); x(13)-x(9)+x(13)-x(17)+x(13)-x(29)]...
    +x(31)*adpunit(K*[x(12)-x(8)+x(12)-x(16)+x(12)-x(28); x(13)-x(9)+x(13)-x(17)+x(13)-x(29)],x(32));

% follower 3
xdot(14) = x(15);
xdot(15) = -x(14)+2*x(15)+x(32)*K*[x(16)-x(8)+x(16)-x(12); x(17)-x(9)+x(17)-x(13)]+x(32)*adpunit(K*[x(16)-x(8)+x(16)-x(12); x(17)-x(9)+x(17)-x(13)],x(32));
xdot(16) = 3*x(14)-3*x(16)+x(17);
xdot(17) = 6*x(14)-7*x(16)++2*x(17)+x(32)*K*[x(16)-x(8)+x(16)-x(12); x(17)-x(9)+x(17)-x(13)]+x(32)*adpunit(K*[x(16)-x(8)+x(16)-x(12); x(17)-x(9)+x(17)-x(13)],x(32));

% follower 4
xdot(18) = x(19);
xdot(19) = -x(18)+2*x(19)+x(33)*K*[x(20)-x(8)+x(20)-x(24); x(21)-x(9)+x(21)-x(25)]+x(33)*adpunit(K*[x(20)-x(8)+x(20)-x(24); x(21)-x(9)+x(21)-x(25)],x(33));
xdot(20) = 3*x(18)-3*x(20)+x(21);
xdot(21) = 6*x(18)-7*x(20)+2*x(21)+x(33)*K*[x(20)-x(8)+x(20)-x(24); x(21)-x(9)+x(21)-x(25)]+x(33)*adpunit(K*[x(20)-x(8)+x(20)-x(24); x(21)-x(9)+x(21)-x(25)],x(33));


% follower 5
xdot(22) = x(23);
xdot(23) = -x(22)+2*x(23)+x(34)*K*[x(24)-x(8)+x(24)-x(20)+x(24)-x(28); x(25)-x(9)+x(25)-x(21)+x(25)-x(29)]...
    +x(34)*adpunit(K*[x(24)-x(8)+x(24)-x(20)+x(24)-x(28); x(25)-x(9)+x(25)-x(21)+x(25)-x(29)],x(34));
xdot(24) = 3*x(22)-3*x(24)+x(25);
xdot(25) = 6*x(22)-7*x(24)+2*x(25)+x(34)*K*[x(24)-x(8)+x(24)-x(20)+x(24)-x(28); x(25)-x(9)+x(25)-x(21)+x(25)-x(29)]...
    +x(34)*adpunit(K*[x(24)-x(8)+x(24)-x(20)+x(24)-x(28); x(25)-x(9)+x(25)-x(21)+x(25)-x(29)],x(35));

% follower 6
xdot(26) = x(27);
xdot(27) = -x(26)+2*x(27)+x(35)*K*[x(28)-x(12)+x(28)-x(24); x(29)-x(13)+x(29)-x(25)]+x(35)*adpunit(K*[x(28)-x(12)+x(28)-x(24); x(29)-x(13)+x(29)-x(25)],x(35));
xdot(28) = 3*x(26)-3*x(28)+x(29);
xdot(29) = 6*x(26)-7*x(28)+2*x(29)+x(35)*K*[x(28)-x(12)+x(28)-x(24); x(29)-x(13)+x(29)-x(25)]+x(35)*adpunit(K*[x(28)-x(12)+x(28)-x(24); x(29)-x(13)+x(29)-x(25)],x(35));


% coupling gains
xdot(30) = 10*([x(8)-x(12)+x(8)-x(16)+x(8)-x(20)+x(8)-x(24)+x(8)-x(4); x(9)-x(13)+x(9)-x(17)+x(9)-x(21)+x(9)-x(25)+x(9)-x(5)]'*G*...
    [x(8)-x(12)+x(8)-x(16)+x(8)-x(20)+x(8)-x(24)+x(8)-x(4); x(9)-x(13)+x(9)-x(17)+x(9)-x(21)+x(9)-x(25)+x(9)-x(5)]+...
    norm(K*[x(8)-x(12)+x(8)-x(16)+x(8)-x(20)+x(8)-x(24)+x(8)-x(4); x(9)-x(13)+x(9)-x(17)+x(9)-x(21)+x(9)-x(25)+x(9)-x(5)])-f1*x(30));
xdot(31) = 10*([x(12)-x(8)+x(12)-x(16)+x(12)-x(28); x(13)-x(9)+x(13)-x(17)+x(13)-x(29)]'*G*[x(12)-x(8)+x(12)-x(16)+x(12)-x(28); x(13)-x(9)+x(13)-x(17)+x(13)-x(29)]+...
    norm(K*[x(12)-x(8)+x(12)-x(16)+x(12)-x(28); x(13)-x(9)+x(13)-x(17)+x(13)-x(29)])-f1*x(31));
xdot(32) = 10*([x(16)-x(8)+x(16)-x(12); x(17)-x(9)+x(17)-x(13)]'*G*[x(16)-x(8)+x(16)-x(12); x(17)-x(9)+x(17)-x(13)]+...
    norm(K*[x(16)-x(8)+x(16)-x(12); x(17)-x(9)+x(17)-x(13)])-f1*x(32));
xdot(33) = 10*([x(20)-x(8)+x(20)-x(24); x(21)-x(9)+x(21)-x(25)]'*G*[x(20)-x(8)+x(20)-x(24); x(21)-x(9)+x(21)-x(25)]+...
    norm(K*[x(20)-x(8)+x(20)-x(24); x(21)-x(9)+x(21)-x(25)])-f1*x(33));
xdot(34) = 10*([x(24)-x(8)+x(24)-x(20)+x(24)-x(28); x(25)-x(9)+x(25)-x(21)+x(25)-x(29)]'*G*[x(24)-x(8)+x(24)-x(20)+x(24)-x(28); x(25)-x(9)+x(25)-x(21)+x(25)-x(29)]+...
    norm(K*[x(24)-x(8)+x(24)-x(20)+x(24)-x(28); x(25)-x(9)+x(25)-x(21)+x(25)-x(29)])-f1*x(34));
xdot(35) = 10*([x(28)-x(12)+x(28)-x(24); x(29)-x(13)+x(29)-x(25)]'*G*[x(28)-x(12)+x(28)-x(24); x(29)-x(13)+x(29)-x(25)]+...
    norm(K*[x(28)-x(12)+x(28)-x(24); x(29)-x(13)+x(29)-x(25)])-f1*x(35));

