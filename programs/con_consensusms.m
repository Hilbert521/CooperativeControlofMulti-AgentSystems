% 
% consensus tracking with respect to a leader with bounded input.
% adaptive controller 
% sigma-modifications
% subjec to matching uncertainties

function xdot=con_consensusms(t,x)

xdot=zeros(24,1);

m=2.5;
k1=2.4*rand; k2=8*rand;
k3=0.4*rand; k4=15*rand;
k5=1.4*rand; k6=12*rand;

K=[-0.6693   -2.4595];
G=[0.4480    1.6462; 1.6462    6.0489];
f1=0.05;

LL=[3 -1 0 0 -1 -1; -1 3 -1 -1 0 0; 0 -1 2 0 0 -1; 0 -1 0 2  0 -1; -1 0 0 0 1 0; -1  0 -1 -1 0 3];


% agent 1
xdot(1)=x(2);
xdot(2)=-k1*x(1)/m+1/m*x(13)*K*[x(1)-x(3)+x(1)-x(9)+x(1)-x(11); x(2)-x(4)+x(2)-x(10)+x(2)-x(12)]...
    +adpunitun(K*[x(1)-x(3)+x(1)-x(9)+x(1)-x(11); x(2)-x(4)+x(2)-x(10)+x(2)-x(12)],x(13)+x(14)*norm([x(1); x(2)]));


% agent 2
xdot(3)=x(4);
xdot(4)=-k1*x(3)/m+1/m*x(15)*K*[x(3)-x(1)+x(3)-x(5)+x(3)-x(7); x(4)-x(2)+x(4)-x(6)+x(4)-x(8)]...
    +adpunitun(K*[x(3)-x(1)+x(3)-x(5)+x(3)-x(7); x(4)-x(2)+x(4)-x(6)+x(4)-x(8)],x(15)+x(16)*norm([x(3); x(4)]));


% agent 3
xdot(5)=x(6);
xdot(6)=-k1*x(5)/m+1/m*x(17)*K*[x(5)-x(11)+x(5)-x(3); x(6)-x(12)+x(6)-x(4)]...
    +adpunitun(K*[x(5)-x(11)+x(5)-x(3); x(6)-x(12)+x(6)-x(4)],x(17)+x(18)*norm([x(5); x(6)]));


% agent 4
xdot(7)=x(8);
xdot(8)=-k1*x(7)/m+1/m*x(19)*K*[x(7)-x(3)+x(7)-x(11); x(8)-x(4)+x(8)-x(12)]...
    +adpunitun(K*[x(7)-x(3)+x(7)-x(11); x(8)-x(4)+x(8)-x(12)],x(19)+x(20)*norm([x(7); x(8)]));


% agent 5
xdot(9)=x(10);
xdot(10)=-k1*x(9)/m+1/m*x(21)*K*[x(9)-x(1); x(10)-x(2)]...
    +adpunitun(K*[x(9)-x(1); x(10)-x(2)],x(21)+x(22)*norm([x(9); x(10)]));


% agent 6
xdot(11)=x(12);
xdot(12)=-k1*x(11)/m+1/m*x(23)*K*[x(11)-x(1)+x(11)-x(7)+x(11)-x(5); x(12)-x(2)+x(12)-x(8)+x(12)-x(6)]...
    +adpunitun(K*[x(11)-x(1)+x(11)-x(7)+x(11)-x(5); x(12)-x(2)+x(12)-x(8)+x(12)-x(6)],x(23)+x(24)*norm([x(11); x(12)]));


% coupling gains
xdot(13) = 10*([x(1)-x(3)+x(1)-x(9)+x(1)-x(11); x(2)-x(4)+x(2)-x(10)+x(2)-x(12)]'*G*...
    [x(1)-x(3)+x(1)-x(9)+x(1)-x(11); x(2)-x(4)+x(2)-x(10)+x(2)-x(12)]+...
    norm(K*[x(1)-x(3)+x(1)-x(9)+x(1)-x(11); x(2)-x(4)+x(2)-x(10)+x(2)-x(12)])-f1*x(13));
xdot(14) = 10*(norm(K*[x(1)-x(3)+x(1)-x(9)+x(1)-x(11); x(2)-x(4)+x(2)-x(10)+x(2)-x(12)])*norm([x(1); x(2)])-f1*x(14));
xdot(15) = 10*([x(3)-x(1)+x(3)-x(5)+x(3)-x(7); x(4)-x(2)+x(4)-x(6)+x(4)-x(8)]'*G*...
    [x(3)-x(1)+x(3)-x(5)+x(3)-x(7); x(4)-x(2)+x(4)-x(6)+x(4)-x(8)]+...
    norm(K*[x(3)-x(1)+x(3)-x(5)+x(3)-x(7); x(4)-x(2)+x(4)-x(6)+x(4)-x(8)])-f1*x(15));
xdot(16) = 10*(norm(K*[x(3)-x(1)+x(3)-x(5)+x(3)-x(7); x(4)-x(2)+x(4)-x(6)+x(4)-x(8)])*...
    norm([x(3);x(4)])-f1*x(16));
xdot(17) = 10*([x(5)-x(11)+x(5)-x(3); x(6)-x(12)+x(6)-x(4)]'*G*...
    [x(5)-x(11)+x(5)-x(3); x(6)-x(12)+x(6)-x(4)]+...
    norm(K*[x(5)-x(11)+x(5)-x(3); x(6)-x(12)+x(6)-x(4)])-f1*x(17));
xdot(18) = 10*(norm(K*[x(5)-x(11)+x(5)-x(3); x(6)-x(12)+x(6)-x(4)])*norm([x(5);x(6)])-f1*x(18));
xdot(19) = 10*([x(7)-x(3)+x(7)-x(11); x(8)-x(4)+x(8)-x(12)]'*G*...
    [x(7)-x(3)+x(7)-x(11); x(8)-x(4)+x(8)-x(12)]+...
    norm(K*[x(7)-x(3)+x(7)-x(11); x(8)-x(4)+x(8)-x(12)])-f1*x(19));
xdot(20) = 10*(norm(K*[x(7)-x(3)+x(7)-x(11); x(8)-x(4)+x(8)-x(12)])*norm([x(7);x(8)])-f1*x(20));
xdot(21) = 10*([x(9)-x(1); x(10)-x(2)]'*G*[x(9)-x(1); x(10)-x(2)]+...
    norm(K*[x(9)-x(1); x(10)-x(2)])-f1*x(21));
xdot(22) = 10*(norm(K*[x(9)-x(1); x(10)-x(2)])*norm([x(9);x(10)])-f1*x(22));
xdot(23) = 10*([x(11)-x(1)+x(11)-x(7)+x(11)-x(5); x(12)-x(2)+x(12)-x(8)+x(12)-x(6)]'*G*...
    [x(11)-x(1)+x(11)-x(7)+x(11)-x(5); x(12)-x(2)+x(12)-x(8)+x(12)-x(6)]+...
    norm(K*[x(11)-x(1)+x(11)-x(7)+x(11)-x(5); x(12)-x(2)+x(12)-x(8)+x(12)-x(6)])-f1*x(23));
xdot(24) = 10*(norm(K*[x(11)-x(1)+x(11)-x(7)+x(11)-x(5); x(12)-x(2)+x(12)-x(8)+x(12)-x(6)])*norm([x(11);x(12)])-f1*x(24));




