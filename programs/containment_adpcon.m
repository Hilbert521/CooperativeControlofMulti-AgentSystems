% containment control with respect to multiple leaders with bounded inputs.
% adaptive controller
% continuous controller, sigma-modification

function xdot=containment_adpcon(t,x)

xdot=zeros(22,1);

% A=[0 1; -1 2]; B=[0; 1];
% A0=[0 1; -1 0];

K=[-1.6203   -4.7567];
G=[2.5255    7.7055; 7.7055    22.6266];
f1=0.005;

% the leader  #1
xdot(1) = x(2);
xdot(2) = -x(1);


% follower 1
xdot(3) = x(4);
xdot(4) = -x(3)+1*x(4)+sin(t)+x(15)*K*[x(3)-x(5)+x(3)-x(7)+x(3)-x(9)+x(3)-x(11)+x(3)-x(1); x(4)-x(6)+x(4)-x(8)+x(4)-x(10)+x(4)-x(12)+x(4)-x(2)]...
    +x(15)*adpunit(K*[x(3)-x(5)+x(3)-x(7)+x(3)-x(9)+x(3)-x(11)+x(3)-x(1); x(4)-x(6)+x(4)-x(8)+x(4)-x(10)+x(4)-x(12)+x(4)-x(2)],x(15));

% follower 2
xdot(5) = x(6);
xdot(6) = -x(5)+1*x(6)+cos(x(6))+x(16)*K*[x(5)-x(3)+x(5)-x(7)+x(5)-x(13)+x(5)-x(21); x(6)-x(4)+x(6)-x(8)+x(6)-x(14)+x(6)-x(22)]...
    +x(16)*adpunit(K*[x(5)-x(3)+x(5)-x(7)+x(5)-x(13)+x(5)-x(21); x(6)-x(4)+x(6)-x(8)+x(6)-x(14)+x(6)-x(22)],x(16));

% follower 3
xdot(7) = x(8);
xdot(8) = -x(7)+1*x(8)+2*sin(2*t)+x(17)*K*[x(7)-x(3)+x(7)-x(5); x(8)-x(4)+x(8)-x(6)]+x(17)*adpunit(K*[x(7)-x(3)+x(7)-x(5); x(8)-x(4)+x(8)-x(6)],x(17));


% follower 4
xdot(9) = x(10);
xdot(10) = -x(9)+1*x(10)+cos(2*t)+x(18)*K*[x(9)-x(3)+x(9)-x(11); x(10)-x(4)+x(10)-x(12)]+x(18)*adpunit(K*[x(9)-x(3)+x(9)-x(11); x(10)-x(4)+x(10)-x(12)],x(18));

% follower 5
xdot(11) = x(12);
xdot(12) = -x(11)+1*x(12)+1.5*sin(x(11))+x(19)*K*[x(11)-x(3)+x(11)-x(9)+x(11)-x(13); x(12)-x(4)+x(12)-x(10)+x(12)-x(14)]...
    +x(19)*adpunit(K*[x(11)-x(3)+x(11)-x(9)+x(11)-x(13); x(12)-x(4)+x(12)-x(10)+x(12)-x(14)],x(19));

% follower 6
xdot(13) = x(14);
xdot(14) = -x(13)+1*x(14)-exp(-2*t)+x(20)*K*[x(13)-x(5)+x(13)-x(11); x(14)-x(6)+x(14)-x(12)]+x(20)*adpunit(K*[x(13)-x(5)+x(13)-x(11); x(14)-x(6)+x(14)-x(12)],x(20));

% coupling gains
xdot(15) = 10*([x(3)-x(5)+x(3)-x(7)+x(3)-x(9)+x(3)-x(11)+x(3)-x(1); x(4)-x(6)+x(4)-x(8)+x(4)-x(10)+x(4)-x(12)+x(4)-x(2)]'*G*...
    [x(3)-x(5)+x(3)-x(7)+x(3)-x(9)+x(3)-x(11)+x(3)-x(1); x(4)-x(6)+x(4)-x(8)+x(4)-x(10)+x(4)-x(12)+x(4)-x(2)]+...
    norm(K*[x(3)-x(5)+x(3)-x(7)+x(3)-x(9)+x(3)-x(11)+x(3)-x(1); x(4)-x(6)+x(4)-x(8)+x(4)-x(10)+x(4)-x(12)+x(4)-x(2)])-f1*x(15));
xdot(16) = 10*([x(5)-x(3)+x(5)-x(7)+x(5)-x(13)+x(5)-x(21); x(6)-x(4)+x(6)-x(8)+x(6)-x(14)+x(6)-x(22)]'*G*[x(5)-x(3)+x(5)-x(7)+x(5)-x(13)+x(5)-x(21); x(6)-x(4)+x(6)-x(8)+x(6)-x(14)+x(6)-x(22)]+...
    norm(K*[x(5)-x(3)+x(5)-x(7)+x(5)-x(13)+x(5)-x(21); x(6)-x(4)+x(6)-x(8)+x(6)-x(14)+x(6)-x(22)])-f1*x(16));
xdot(17) = 10*([x(7)-x(3)+x(7)-x(5); x(8)-x(4)+x(8)-x(6)]'*G*[x(7)-x(3)+x(7)-x(5); x(8)-x(4)+x(8)-x(6)]+...
    norm(K*[x(7)-x(3)+x(7)-x(5); x(8)-x(4)+x(8)-x(6)])-f1*x(17));
xdot(18) = 10*([x(9)-x(3)+x(9)-x(11); x(10)-x(4)+x(10)-x(12)]'*G*[x(9)-x(3)+x(9)-x(11); x(10)-x(4)+x(10)-x(12)]+...
    norm(K*[x(9)-x(3)+x(9)-x(11); x(10)-x(4)+x(10)-x(12)])-f1*x(18));
xdot(19) = 10*([x(11)-x(3)+x(11)-x(9)+x(11)-x(13); x(12)-x(4)+x(12)-x(10)+x(12)-x(14)]'*G*[x(11)-x(3)+x(11)-x(9)+x(11)-x(13); x(12)-x(4)+x(12)-x(10)+x(12)-x(14)]+...
    norm(K*[x(11)-x(3)+x(11)-x(9)+x(11)-x(13); x(12)-x(4)+x(12)-x(10)+x(12)-x(14)])-f1*x(19));
xdot(20) = 10*([x(13)-x(5)+x(13)-x(11); x(14)-x(6)+x(14)-x(12)]'*G*[x(13)-x(5)+x(13)-x(11); x(14)-x(6)+x(14)-x(12)]+...
    norm(K*[x(13)-x(5)+x(13)-x(11); x(14)-x(6)+x(14)-x(12)])-f1*x(20));

% the leader #2
xdot(21) = x(22);
xdot(22) = -2*x(21);

