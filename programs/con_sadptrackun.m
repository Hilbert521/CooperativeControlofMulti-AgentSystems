% 
% consensus tracking with respect to a leader with bounded input.
% adaptive controller 
% sigma-modifications
% subjec to matching uncertainties

function xdot=con_sadptrackun(t,x)

xdot=zeros(33,1);

a=10; b=18; m01=-3/4; m02=-4/3;
% m11=-3/4;m21=-3/4;m31=-3/4;m41=-3/4;m51=-3/4;m61=-3/4;
% m12=-4/3;m22=-4/3;m32=-4/3;m42=-4/3;m52=-4/3;m62=-4/3;
% 
m11=-2.4*rand; m12=-1.5*rand;
m21=-2*rand; m22=-3*rand;
m31=-2.5*rand; m32=-1.5*rand;
m41=-1.8*rand; m42=-2.6*rand;
m51=-2.4*rand; m52=-1*rand;
m61=-2*rand; m62=-3.5*rand;

K=[-16.9070  -16.5791   -1.8297];
G=[285.8453  280.3016   30.9344;280.3016  274.8654   30.3344; 30.9344   30.3344    3.3477];
f1=0.05;

M=[0 0 0 0 0 0 0; -2 6 -1 -1 -1 -1 0; 0 -1 3 -1 0 0 -1; 0 -1 -1 2 0 0 0; 0 -1 0 0 2 -1 0; 0 -1 0 0 -1 3 -1; 0  0 -1 0 0 -1 2];


% the leader +sin(x(1))
xdot(1)=a*(-x(1)+x(2)-m01*x(1)-(m02-m01)/2*(abs(x(1)+1)-abs(x(1)-1)));
xdot(2)=x(1)-x(2)+x(3);
xdot(3)=-b*x(2);


% follower 1
xdot(4)=a*(-x(4)+x(5)-m11*x(1)-(m12-m11)/2*(abs(x(4)+1)-abs(x(4)-1)))...
    +x(22)*K*[x(4)-x(7)+x(4)-x(10)+x(4)-x(13)+x(4)-x(16)+x(4)-x(1); x(5)-x(8)+x(5)-x(11)+x(5)-x(14)+x(5)-x(17)+x(5)-x(2); ...
              x(6)-x(9)+x(6)-x(12)+x(6)-x(15)+x(6)-x(18)+x(6)-x(3)]...
    +adpunitun(K*[x(4)-x(7)+x(4)-x(10)+x(4)-x(13)+x(4)-x(16)+x(4)-x(1); x(5)-x(8)+x(5)-x(11)+x(5)-x(14)+x(5)-x(17)+x(5)-x(2);...
                        x(6)-x(9)+x(6)-x(12)+x(6)-x(15)+x(6)-x(18)+x(6)-x(3)],x(22)+x(23)*norm([x(4); x(5); x(6)]));
xdot(5)=x(4)-x(5)+x(6);
xdot(6)=-b*x(5);


% follower 2
xdot(7)=a*(-x(7)+x(8)-m21*x(7)-(m22-m21)/2*(abs(x(7)+1)-abs(x(7)-1)))...
    +x(24)*K*[x(7)-x(4)+x(7)-x(10)+x(7)-x(19); x(8)-x(5)+x(8)-x(11)+x(8)-x(20); x(9)-x(6)+x(9)-x(12)+x(9)-x(21)]...
    +adpunitun(K*[x(7)-x(4)+x(7)-x(10)+x(7)-x(19); x(8)-x(5)+x(8)-x(11)+x(8)-x(20); x(9)-x(6)+x(9)-x(12)+x(9)-x(21)],x(24)+x(25)*norm([x(7); x(8); x(9)]));
xdot(8)=x(7)-x(8)+x(9);
xdot(9)=-b*x(8);


% follower 3
xdot(10)=a*(-x(10)+x(11)-m31*x(10)-(m32-m31)/2*(abs(x(10)+1)-abs(x(10)-1)))...
    +x(26)*K*[x(10)-x(4)+x(10)-x(7); x(11)-x(5)+x(11)-x(8); x(12)-x(6)+x(12)-x(9)]...
    +adpunitun(K*[x(10)-x(4)+x(10)-x(7); x(11)-x(5)+x(11)-x(8); x(12)-x(6)+x(12)-x(9)],x(26)+x(27)*norm([x(10); x(11); x(12)]));
xdot(11)=x(10)-x(11)+x(12);
xdot(12)=-b*x(11);



% follower 4
xdot(13)=a*(-x(13)+x(14)-m41*x(13)-(m42-m41)/2*(abs(x(13)+1)-abs(x(13)-1)))...
    +x(28)*K*[x(13)-x(4)+x(13)-x(16); x(14)-x(5)+x(14)-x(17); x(15)-x(6)+x(15)-x(18)]...
    +adpunitun(K*[x(13)-x(4)+x(13)-x(16); x(14)-x(5)+x(14)-x(17); x(15)-x(6)+x(15)-x(18)],x(28)+x(29)*norm([x(13); x(14); x(15)]));
xdot(14)=x(13)-x(14)+x(15);
xdot(15)=-b*x(14);


% follower 5
xdot(16)=a*(-x(16)+x(17)-m51*x(16)-(m52-m51)/2*(abs(x(16)+1)-abs(x(16)-1)))...
    +x(30)*K*[x(16)-x(4)+x(16)-x(13)+x(16)-x(19); x(17)-x(5)+x(17)-x(14)+x(17)-x(20); x(18)-x(6)+x(18)-x(15)+x(18)-x(21)]...
    +adpunitun(K*[x(16)-x(4)+x(16)-x(13)+x(16)-x(19); x(17)-x(5)+x(17)-x(14)+x(17)-x(20); x(18)-x(6)+x(18)-x(15)+x(18)-x(21)],...
    x(30)+x(31)*norm([x(16); x(17); x(18)]));
xdot(17)=x(16)-x(17)+x(18);
xdot(18)=-b*x(17);


% follower 6
xdot(19)=a*(-x(19)+x(20)-m61*x(19)-(m62-m61)/2*(abs(x(19)+1)-abs(x(19)-1)))...
    +x(32)*K*[x(19)-x(7)+x(19)-x(16); x(20)-x(8)+x(20)-x(17); x(21)-x(9)+x(21)-x(18)]...
    +adpunitun(K*[x(19)-x(7)+x(19)-x(16); x(20)-x(8)+x(20)-x(17); x(21)-x(9)+x(21)-x(18)],x(32)+x(33)*norm([x(19); x(20); x(21)]));
xdot(20)=x(19)-x(20)+x(21);
xdot(21)=-b*x(20);


% coupling gains
xdot(22) = 10*([x(4)-x(7)+x(4)-x(10)+x(4)-x(13)+x(4)-x(16)+x(4)-x(1); x(5)-x(8)+x(5)-x(11)+x(5)-x(14)+x(5)-x(17)+x(5)-x(2); ...
              x(6)-x(9)+x(6)-x(12)+x(6)-x(15)+x(6)-x(18)+x(6)-x(3)]'*G*...
    [x(4)-x(7)+x(4)-x(10)+x(4)-x(13)+x(4)-x(16)+x(4)-x(1); x(5)-x(8)+x(5)-x(11)+x(5)-x(14)+x(5)-x(17)+x(5)-x(2); ...
              x(6)-x(9)+x(6)-x(12)+x(6)-x(15)+x(6)-x(18)+x(6)-x(3)]+...
    norm(K*[x(4)-x(7)+x(4)-x(10)+x(4)-x(13)+x(4)-x(16)+x(4)-x(1); x(5)-x(8)+x(5)-x(11)+x(5)-x(14)+x(5)-x(17)+x(5)-x(2); ...
              x(6)-x(9)+x(6)-x(12)+x(6)-x(15)+x(6)-x(18)+x(6)-x(3)])-f1*x(22));
xdot(23) = 10*(norm(K*[x(4)-x(7)+x(4)-x(10)+x(4)-x(13)+x(4)-x(16)+x(4)-x(1); x(5)-x(8)+x(5)-x(11)+x(5)-x(14)+x(5)-x(17)+x(5)-x(2); ...
              x(6)-x(9)+x(6)-x(12)+x(6)-x(15)+x(6)-x(18)+x(6)-x(3)])*norm([x(4); x(5); x(6)])-f1*x(23));
xdot(24) = 10*([x(7)-x(4)+x(7)-x(10)+x(7)-x(19); x(8)-x(5)+x(8)-x(11)+x(8)-x(20); x(9)-x(6)+x(9)-x(12)+x(9)-x(21)]'*G*...
    [x(7)-x(4)+x(7)-x(10)+x(7)-x(19); x(8)-x(5)+x(8)-x(11)+x(8)-x(20); x(9)-x(6)+x(9)-x(12)+x(9)-x(21)]+...
    norm(K*[x(7)-x(4)+x(7)-x(10)+x(7)-x(19); x(8)-x(5)+x(8)-x(11)+x(8)-x(20); x(9)-x(6)+x(9)-x(12)+x(9)-x(21)])-f1*x(24));
xdot(25) = 10*(norm(K*[x(7)-x(4)+x(7)-x(10)+x(7)-x(19); x(8)-x(5)+x(8)-x(11)+x(8)-x(20); x(9)-x(6)+x(9)-x(12)+x(9)-x(21)])*...
    norm([x(7);x(8); x(9)])-f1*x(25));
xdot(26) = 10*([x(10)-x(4)+x(10)-x(7); x(11)-x(5)+x(11)-x(8); x(12)-x(6)+x(12)-x(9)]'*G*...
    [x(10)-x(4)+x(10)-x(7); x(11)-x(5)+x(11)-x(8); x(12)-x(6)+x(12)-x(9)]+...
    norm(K*[x(10)-x(4)+x(10)-x(7); x(11)-x(5)+x(11)-x(8); x(12)-x(6)+x(12)-x(9)])-f1*x(26));
xdot(27) = 10*(norm(K*[x(10)-x(4)+x(10)-x(7); x(11)-x(5)+x(11)-x(8); x(12)-x(6)+x(12)-x(9)])*norm([x(10);x(11); x(12)])-f1*x(27));
xdot(28) = 10*([x(13)-x(4)+x(13)-x(16); x(14)-x(5)+x(14)-x(17); x(15)-x(6)+x(15)-x(18)]'*G*...
    [x(13)-x(4)+x(13)-x(16); x(14)-x(5)+x(14)-x(17); x(15)-x(6)+x(15)-x(18)]+...
    norm(K*[x(13)-x(4)+x(13)-x(16); x(14)-x(5)+x(14)-x(17); x(15)-x(6)+x(15)-x(18)])-f1*x(28));
xdot(29) = 10*(norm(K*[x(13)-x(4)+x(13)-x(16); x(14)-x(5)+x(14)-x(17); x(15)-x(6)+x(15)-x(18)])*norm([x(13);x(14); x(15)])-f1*x(29));
xdot(30) = 10*([x(16)-x(4)+x(16)-x(13)+x(16)-x(19); x(17)-x(5)+x(17)-x(14)+x(17)-x(20); x(18)-x(6)+x(18)-x(15)+x(18)-x(21)]'*G*...
    [x(16)-x(4)+x(16)-x(13)+x(16)-x(19); x(17)-x(5)+x(17)-x(14)+x(17)-x(20); x(18)-x(6)+x(18)-x(15)+x(18)-x(21)]+...
    norm(K*[x(16)-x(4)+x(16)-x(13)+x(16)-x(19); x(17)-x(5)+x(17)-x(14)+x(17)-x(20); x(18)-x(6)+x(18)-x(15)+x(18)-x(21)])-f1*x(30));
xdot(31) = 10*(norm(K*[x(16)-x(4)+x(16)-x(13)+x(16)-x(19); x(17)-x(5)+x(17)-x(14)+x(17)-x(20); x(18)-x(6)+x(18)-x(15)+x(18)-x(21)])*...
    norm([x(16);x(17); x(18)])-f1*x(31));
xdot(32) = 10*([x(19)-x(7)+x(19)-x(16); x(20)-x(8)+x(20)-x(17); x(21)-x(9)+x(21)-x(18)]'*G*...
    [x(19)-x(7)+x(19)-x(16); x(20)-x(8)+x(20)-x(17); x(21)-x(9)+x(21)-x(18)]+...
    norm(K*[x(19)-x(7)+x(19)-x(16); x(20)-x(8)+x(20)-x(17); x(21)-x(9)+x(21)-x(18)])-f1*x(32));
xdot(33) = 10*(norm(K*[x(19)-x(7)+x(19)-x(16); x(20)-x(8)+x(20)-x(17); x(21)-x(9)+x(21)-x(18)])*norm([x(19);x(20); x(21)])-f1*x(33));




